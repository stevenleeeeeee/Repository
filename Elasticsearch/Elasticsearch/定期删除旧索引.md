#### 将索引中过去30天的数据删除
```txt
POST <index>/_delete_by_query
{
    "query": {
        "range" : {
            "@timestamp" : {
                "lt" :  "now-30d/d"
            }
        }
    }
}
虽然可以使用但存在以下问题： 
    1. 搜索会造成额外性能消耗，尤其是数据量大的时候 
    2. 30天的日志都在1个index里，影响性能
```
#### 删除测试环境过期的索引
```bash
#!/bin/bash
#删除ES中4天前的索引数据，保证测试环境的容量不被占用过多

DATE=`date +%Y.%m.%d -d "-4 day"`

#删除ES中前4天的logstash索引
curl -XDELETE  http://kibana4-admin:password@192.168.100.4:9200/logstash-${DATE} &>/dev/null
```
#### Crontab
```txt
30 2 * * * /bin/sh /home/zyzx/bin/elk_purge.sh
```
#### Example:
```txt
这是实际删除命令但删除后索引还在数据库中只是被标签成删除，空间并且没有释放
curl -XDELETE http://192.168.1.141:9200/logstash-2018.05.02 

所以运行删除前要把索引先在ES中下架再删除就可以马上释放空间:
curl -XPOST 'http://192.168.1.141:9200/logstash-2018.05.02/_forcemerge?only_expunge_deletes=true'

#Demo ----------------------------------
#!/bin/bash
logindex=$1
year=2018
curl -XPOST http://192.168.1.141:9200/logstash-${year}.${logindex}/_forcemerge?only_expunge_deletes=true
curl -XDELETE http://192.168.1.141:9200/logstash-${year}.${logindex}
----------------------------------------
```
