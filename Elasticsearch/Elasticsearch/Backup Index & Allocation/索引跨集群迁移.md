```bash
# https://cloud.tencent.com/developer/article/1145944

# 以下操作表示从源ES集群中查询名为test1的索引，查询条件为title字段为elasticsearch，将结果写入当前集群的test2索引

POST _reindex   # 先创建Mapping
{
	"source": {
		"remote": {
			"host": "http://172.16.0.39:9200",  # 远程es的ip和port列表
            "username": "xxxx",
            "password": "xxxx",
            "socket_timeout": "1m",
            "connect_timeout": "10s"    # 超时时间设置
		},
		"index": "test",
        "size": 3000,       # 每次获取3000条数据
		"query": {          # 满足条件的数据
			"match_all": { }
		}
	},
	"dest": {
	 	"index": "test"     # 目标索引名称
	}
}

# 注意
# 被复制的远程主机必须在elasticsearch.yaml配置文件使用reindex.remote.whitelist属性显式列入白名单：
# reindex.remote.whitelist: "otherhost:9200, another:9200, 127.0.10.*:9200, localhost:*"
```
#### 在Logstash执行数据迁移 ( 先创建Mapping )
```bash
# 使用logstash:
# 执行后会将源Cluster中所有index全部copy到目标Cluster中，并将mapping信息携带过去，随后开始逐步做index内的数据迁移
# 建议：正式执行的时候 ---> stdout { codec => rubydebug { metadata => true } }

# metadata：
# logstash 1.5版本后使用了metadata的概念来描述1次event并允许被用户修改，但不会写到event的结果中对event的结果产生影响
# 除此之外metadata将作为event的元数据描述信息，可以在input、filter、output三种插件的全执行周期内存活

# docinfo：
# elasticsearch input插件中的一个参数，默认是false
# 官网原文是"If set, include Elasticsearch document information such as index, type, and the id in the event."
# 意味着设置此字段后，会将index、type、id等信息全部记录到event中去，即metadata中去
# 这也就意味着可以在整个event执行周期内，使用者可随意的使用index、type、id这些参数了 

# elasticsearch input插件中的index参数支持通配符，可使用"*"这样的模糊匹配通配符来表示所有对象 
# 由于metadata的特性，我们可以在output中直接"继承"input中的index、type信息
# 并在目标Cluster中直接创建和源Cluster一摸一样的index和type，甚至是id（还需要处理映射!）

input {
  elasticsearch {
    hosts => ["XX.XX.XX.XX:9212","XX.XX.XX.XX:9212","XX.XX.XX.XX:9212"]
    index => "<INDEX>"
    size => 1000
    scroll => "5m"
    docinfo => true
    user => 'username...'
    password => "pass...."
  }
}

filter {
#   mutate {
#     remove_field => ["@version"]
#   }
}

output {
  elasticsearch {
    hosts => ["XX.XX.XX.XX:9212","XX.XX.XX.XX:9212","XX.XX.XX.XX:9212"] 
    index => "%{[@metadata][_index]}"
    action => "create"      # 为文档建立索引，如果索引中已经存在具有该ID的文档，则该索引将失败。
    user => "elasticsearch"
    password => "elastic"
    codec => "json"
  }
}
```